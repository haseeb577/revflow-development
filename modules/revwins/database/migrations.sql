BEGIN;
CREATE TABLE IF NOT EXISTS prompt_categories (id SERIAL PRIMARY KEY, name VARCHAR(100) NOT NULL UNIQUE, description TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE IF NOT EXISTS prompts (id SERIAL PRIMARY KEY, category_id INTEGER REFERENCES prompt_categories(id), name VARCHAR(200) NOT NULL, slug VARCHAR(200) NOT NULL, version INTEGER DEFAULT 1, content TEXT NOT NULL, variables JSONB DEFAULT '[]'::jsonb, metadata JSONB DEFAULT '{}'::jsonb, is_active BOOLEAN DEFAULT true, created_by VARCHAR(100), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, UNIQUE(slug, version));
INSERT INTO prompt_categories (name, description) VALUES ('page_generation', 'Full page content generation'), ('field_components', 'Component-level prompts'), ('revflow_pipeline', 'RevFlow pipeline prompts'), ('enhancement_layers', 'Enhancement layers'), ('qa_validation', 'QA prompts'), ('industry_specific', 'Industry prompts') ON CONFLICT (name) DO NOTHING;
CREATE TABLE IF NOT EXISTS gsc_properties (id SERIAL PRIMARY KEY, site_id INTEGER, property_url VARCHAR(500) NOT NULL UNIQUE, verification_status VARCHAR(50) DEFAULT 'pending', last_sync_at TIMESTAMP, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE IF NOT EXISTS gsc_search_analytics (id SERIAL PRIMARY KEY, property_id INTEGER REFERENCES gsc_properties(id), query VARCHAR(500), page VARCHAR(1000), device VARCHAR(50), country VARCHAR(10), date DATE NOT NULL, clicks INTEGER DEFAULT 0, impressions INTEGER DEFAULT 0, ctr DECIMAL(5,4), position DECIMAL(5,2), created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, UNIQUE(property_id, query, page, device, country, date));
CREATE TABLE IF NOT EXISTS photo_submissions (id SERIAL PRIMARY KEY, job_id VARCHAR(100), site_id INTEGER, service_type VARCHAR(200), technician_name VARCHAR(200), submission_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP, gps_latitude DECIMAL(10,8), gps_longitude DECIMAL(11,8), address TEXT, neighborhood VARCHAR(200), city VARCHAR(100), state VARCHAR(50), status VARCHAR(50) DEFAULT 'pending', metadata JSONB DEFAULT '{}'::jsonb);
CREATE TABLE IF NOT EXISTS photos (id SERIAL PRIMARY KEY, submission_id INTEGER REFERENCES photo_submissions(id), photo_type VARCHAR(50) NOT NULL, original_filename VARCHAR(500), stored_filename VARCHAR(500), storage_url VARCHAR(1000), file_size_bytes INTEGER, width INTEGER, height INTEGER, format VARCHAR(20), exif_data JSONB, has_valid_gps BOOLEAN DEFAULT false, alt_text TEXT, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE IF NOT EXISTS lead_synopses (id SERIAL PRIMARY KEY, ghl_contact_id VARCHAR(100) UNIQUE, company_name VARCHAR(500), company_domain VARCHAR(500), contact_email VARCHAR(500), contact_name VARCHAR(500), lead_score_total INTEGER, budget_likelihood_score INTEGER, pain_impact_score INTEGER, icp_fit_score INTEGER, priority_tier VARCHAR(10), synopsis TEXT, synopsis_generated_at TIMESTAMP, engagement_signals JSONB, firmographics JSONB, revflow_triggered BOOLEAN DEFAULT false, created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP);
CREATE INDEX IF NOT EXISTS idx_prompts_slug ON prompts(slug);
CREATE INDEX IF NOT EXISTS idx_lead_synopses_priority ON lead_synopses(priority_tier);
COMMIT;
